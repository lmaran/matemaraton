<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Acasă</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/modifica">Cursuri</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/{{courseId}}/modifica">{{courseCode}}</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/modifica">
                Cap.{{inc chapterIndex}}</a></li>
        
        {{#if isEditMode}}
        <li class="breadcrumb-item active">L.{{inc lessonIndex}}</li>
        <li title="Vizualizează" class="ms-auto"><a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/{{lessonId}}"><i class="bi bi-eye me-1"></i></a></li>
        {{/if}}
    </ol>
</nav>

<h1>{{#if isEditMode}}Lecția {{inc lessonIndex}}: {{lesson.name}}{{else}}Lecție nouă{{/if}}</h1>

<form method="post" novalidate onsubmit="saveBtn.disabled = true; return true;">

    <div class="row mb-3">
        <div class="col-md-12">
            <label for="nameInput" class="fw-bold">Titlul lecției:</label>
            <input type="text" name="name" class="form-control" id="nameInput" placeholder=""
                value="{{lesson.name}}">
            {{!-- <small>
                <p class="text-muted mb-0">Ex: Numere raționale</p>
            </small> --}}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <label for="descriptionInput" class="fw-bold">Descriere:</label>
            <textarea type="text" name="description" class="form-control" id="descriptionInput"
                placeholder="">{{lesson.description}}</textarea>
            <small><p class="text-muted mb-0">Doar tu (proprietarul) poți vedea această descriere</p></small>
        </div>
    </div>

    {{!-- theory --}}
    <div class="row mb-3">
        <div class="col-md-12 theory-div">
            <label class="required fw-bold">Noțiuni teoretice:</label>

            {{!-- close the textarea tag on the same line to get rid of the unintended spaces: https://stackoverflow.com/a/34102261 --}}
            <textarea id="theory-editor-txt" rows="8" name="theory" type="text" 
                style="border-radius:0; border-bottom-width:0; border-color:#bb815d"
                class="form-control {{#if errors.lastName}}is-invalid {{/if}} {{#if isEditMode}}d-none{{/if}}" placeholder="">{{lesson.theory.text}}</textarea>
            <div class="invalid-feedback">{{errors.theory.msg}}</div>

            <div id="theory-preview-div" class="mt-0"
                style="border: 1px solid #bb815d; padding: 6px 12px; background-color: #fff9f8; min-height:58px">
                {{{lesson.theory.textPreview}}}
            </div>

            <span class="ms-end">
                <a id="toggle-theory-editor-btn" href="">{{#if isEditMode}}Editează{{else}}Ascunde{{/if}}</a>
            </span>


        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="positionSelect" class="fw-bold">Poziția în listă:</label>
            <select name="position" class="form-select" id="positionSelect">
                {{#select selectedPosition}}
                {{#each availablePositions}}
                <option value="{{index}}">{{name}}</option>
                {{/each}}
                {{/select}}
            </select>
            {{!-- <small>
                <p class="text-muted mb-0">Poziția în cadrul listei</p>
            </small> --}}
        </div>
    </div>

    <div class="form-check">
        <input type="checkbox" class="form-check-input" id="isHiddenCheck" name="isHidden" {{#if
            lesson.isHidden}}checked{{/if}}>
        <label class="form-check-label" for="isHiddenCheck">Ascunde</label>
        <small>
            <p class="text-muted mb-0">Doar tu (proprietarul) poți vedea resursele ascunse</p>
        </small>
    </div>

    {{#if isEditMode}}
    {{!-- <h4 class="mt-4">2. Exerciții rezolvate</h4>
    <a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/adauga-exercițiu-rezolvat"
    class="btn btn-primary btn-sm">
    <i class="bi bi-plus-lg"></i> Adaugă exercițiu rezolvat</a>

    <h4 class="mt-3">3. Exerciții propuse</h4>

    <a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/adauga-exercițiu-propus"
    class="btn btn-primary btn-sm">
    <i class="bi bi-plus-lg"></i> Adaugă exercițiu propus</a> --}}

        {{#each lesson.sectionsObj.sections}}
        <h4 class="mt-5">{{displayNumber}}. {{name}}<span class="fw-light text-muted ms-1">({{total}})</span></h4>
        {{#each levels}}
            {{!-- {{#if exercises.length}} --}}
            <div id="section{{../id}}-level{{id}}"  class="level-menu-div">
                <strong>{{name}}</strong>
                <span class="text-muted">
                    {{#if (eq exercises.length 1)}} (1 exercițiu):
                    {{else}} ({{exercises.length}} exerciții):
                    {{/if}} 
                </span>

                <a class="add-exercise-btn me-2" title="Adaugă exercițiu" 
                    href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../id}}/niveluri/{{id}}/exercitii/adauga">
                    <i class="bi bi-plus-square"></i></a>
                
                {{#if exercises.length}}
                <a class="toggle-level-btn me-2" href="#">{{#if isActive}}Ascunde exercițiile{{else}}Afișează{{/if}}</a>
                {{!-- <span class="text-muted ms-2 me-2"></span> --}}
                {{/if}}
                
            </div>
            <div class="level-content-div mb-3 ms-4 {{#unless isActive}}d-none{{/unless}}">
            {{#each exercises}}
            <div class="exercise-div">
                <div class="statement-div mt-3" style="border: 1px solid #b99888; padding: 6px 12px; background-color: #fff9f8; min-height:58px">
                    {{{question.statement.textPreview}}}
                    {{#if question.answerOptions}}
                        <div class="row">
                        {{#each question.answerOptions}}
                        <div class="col text-nowrap">{{{textPreview}}}</div>
                        {{/each}}
                        </div>
                    {{/if}}
                </div>

                <div class="exercise-menu-div clearfix">
                    <div class="float-start">
                        {{#if question.hints}}
                            <a class="toggle-hints-btn" href="">Indicații</a>
                            <span class="text-muted">({{question.hints.length}})</span>
                            <span class="text-muted ms-2 me-2">|</span>
                        {{/if}}

                        {{#if question.solution.textPreview}}
                            <a class="toggle-solution-btn" href="">Soluție</a>
                        {{/if}}
                    </div>

                    {{!-- Exercise menu --}}
                    <div class="float-end">
                        <a title="Vizualizează exercițiul" 
                            href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../../id}}/niveluri/{{../id}}/exercitii/{{_id}}">
                            <i class="bi bi-eye me-1"></i></a>
                        
                        <a title="Editează exercițiul" 
                            href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../../id}}/niveluri/{{../id}}/exercitii/{{_id}}/modifica">
                            <i class="bi bi-pencil me-1"></i></a>

                        <button title="Șterge exercițiul" type="submit"
                            formaction="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/exercitii/{{_id}}/sterge"
                            name="deleteBtn" class="btn btn-link p-0 border-0 me-1 align-top"
                            onclick="return confirm('Ești sigur că vrei să ștergi acest exercițiu?');"><i class="bi bi-trash"></i></button>

                        <a title="Mută exercițiul" 
                            href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../../id}}/niveluri/{{../id}}/exercitii/{{_id}}/muta">
                            <i class="bi bi-arrows-move me-1"></i></a>
                    </div>
                </div>

                <div class="exercise-details-div clearfix">
                    <div class="float-start">
                        
                        {{!-- {{#if question.hints}}
                            <a class="toggle-hints-btn" href="">Indicații</a>
                            <span class="text-muted">({{question.hints.length}})</span>
                            <span class="text-muted ms-2 me-2">|</span>
                        {{/if}}

                        {{#if question.solution.textPreview}}
                            <a class="toggle-solution-btn" href="">Soluție</a>
                        {{/if}} --}}
                    </div>

                    {{!-- Exercise menu --}}
                    <div class="float-end">
                        <span class="text-muted">{{author}}</span>
                    </div>
                </div>

                {{#if question.hints}}
                    <div class="hints-div d-none mb-4" data-total-hints="{{question.hints.length}}"
                        style="border: 1px solid #007bff; padding: 6px 12px; background-color: #f5faff; min-height:58px">
                        {{#each question.hints}}
                            <div {{#if (ne @index 0)}} class="d-none" {{/if}} data-hint-nr="{{inc @index}}">{{{textPreview}}}</div>
                        {{/each}}
                        {{#if (gt question.hints.length 1)}}
                            <button type="button" class="show-next-hint-btn btn btn-link p-0">Vezi următoarea indicație</button>
                        {{/if}}
                    </div>
                {{/if}}

                {{#if question.solution.textPreview}}
                    <div class="solution-div d-none">
                        <div class="fw-bold mt-2">Soluție:</div>
                        <div style2"border: 1px solid lightgray; padding: 6px 12px; background-color: min-height:58px">
                            {{{question.solution.textPreview}}}
                        </div>
                    </div>
                {{/if}}
            </div>
            {{/each}}
            
            {{!-- <a class="btn btn-outline-primary btn-sm mt-3" 
                href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../id}}/niveluri/{{id}}/exercitii/adauga">
                <i class="bi bi-plus-lg"></i> Adaugă exercițiu</a>  --}}

            </div>
        {{/each}}
        {{/each}}
    {{else}}
    <div class="alert alert-info mt-4" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    Salvează lecția pentru a putea adăuga exerciții!
    </div>
    {{/if}}

    <input type="hidden" name="courseId" value="{{courseId}}" />
    <input type="hidden" name="chapterId" value="{{chapterId}}" />

    <div class="mt-4">
        <div class="col-md-7s offset-md-3s">
            <button type="submit" name="saveBtn" class="btn btn-primary"><i class="bi bi-save"></i>
                Salveaza</button>

            {{#if isEditMode}}
            {{!-- <a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/{{lessonId}}"
                class="btn btn-light"><i class="bi bi-eye"></i>
                Vizualizează</a> --}}
            <button type="submit"
                formaction="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/{{lessonId}}/sterge"
                name="deleteBtn" class="btn btn-link"
                onclick="return confirm('Ești sigur că vrei să ștergi această lecție?');"><i
                    class="bi bi-trash-fill"></i>
                Șterge</button>
            {{/if}}
        </div>
    </div>

</form>

{{!-- <hr class="mt-5 mb-5"> --}}
<div class="mt-5"></div>



{{#section 'script'}}
<script type="module" src="/js/course-lesson/course-lesson-create-or-edit.js"></script>
{{/section}}