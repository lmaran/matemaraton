<div class="container-fluid">

    {{!-- <p>{{toJSON data}}</p> --}}
    {{!-- <p>{{toJSON errors}}</p> --}}


    {{#if errors.page}}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-circle me-2"></i> {{errors.page.msg}}
    </div>
    {{/if}}

    <h1>Crează cont nou</h1>

    <form method="post" id="signupForm" action="/signup" novalidate onsubmit="saveBtn.disabled = true; return true;">
        <div class="row mb-3">
            <label for="lastName" class="col-md-3 col-form-label required">Nume</label>
            <div class="col-md-7">
                <input type="text" name="lastName" id="lastName"
                    class="form-control {{#if errors.lastName}}is-invalid {{/if}}" value="{{data.lastName.val}}"
                    {{#if uiData.lastName.hasAutofocus}}autofocus {{/if}} />
                <div class="invalid-feedback">{{errors.lastName.msg}}</div>
            </div>
        </div>

        <div class="row mb-3">
            <label for="firstName" class="col-md-3 col-form-label required">Prenume</label>
            <div class="col-md-7">
                <input type="text" name="firstName" id="firstName"
                    class="form-control {{#if errors.firstName}}is-invalid {{/if}}" value="{{data.firstName.val}}"
                    {{#if uiData.firstName.hasAutofocus}}autofocus {{/if}} />
                <div class="invalid-feedback">{{errors.firstName.msg}}</div>
            </div>
        </div>

        <div class="row mb-3">
            <label for="email" class="col-md-3 col-form-label required">Email</label>
            <div class="col-md-7">
                <input type="email" name="email" id="email" class="form-control {{#if errors.email}}is-invalid {{/if}}"
                    value="{{data.email.val}}" {{#if uiData.email.hasAutofocus}}autofocus {{/if}}
                    {{#if uiData.email.isReadOnly}}readonly="readonly" {{/if}} />
                <div class="invalid-feedback">{{errors.email.msg}}</div>
            </div>
        </div>

        <div class="row mb-3">
            <label for="password" class="col-md-3 col-form-label required">Stabilește o parolă</label>
            <div class="col-md-7">
                <input type="password" name="password" id="password"
                    class="form-control {{#if errors.password}}is-invalid {{/if}}" value="{{data.password.val}}"
                    {{#if uiData.password.hasAutofocus}}autofocus {{/if}} />
                <p class="text-muted mb-0">Minim 6 caractere</p>
                <div class="invalid-feedback">{{errors.password.msg}}</div>
            </div>
        </div>

        <div class="row mb-3">
            <label for="confirmPassword" class="col-md-3 col-form-label required">Confirmă parola</label>
            <div class="col-md-7">
                <input type="password" name="confirmPassword" id="confirmPassword"
                    class="form-control {{#if errors.confirmPassword}}is-invalid {{/if}}"
                    value="{{data.confirmPassword.val}}" {{#if uiData.confirmPassword.hasAutofocus}}autofocus {{/if}} />
                <div class="invalid-feedback">{{errors.confirmPassword.msg}}</div>
            </div>
        </div>

        <input type="hidden" name="invitationCode" value="{{data.invitationCode}}" />
        <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response" />

        <div class="row mb-3">
            <div class="col-md-7 offset-md-3">
                <button type="submit" name="saveBtn" class="btn btn-primary"><i class="bi bi-save"></i>
                    Salveaza</button>
                <button type="button" class="btn btn-light" onclick='window.history.back();'>
                    <i class="bi bi-x"></i>
                    Renunta</button>
            </div>
        </div>
    </form>

    <div class="row mb-3">
        <div class="col-md-7 offset-md-3">
            Ti-ai uitat parola? <a href="/reset-password">Reseteaza parola.</a>
        </div>
    </div>

</div>

{{#section 'script-after'}}
{{!-- https://developers.google.com/recaptcha/docs/v3#programmatically_invoke_the_challenge --}}
<script src="https://www.google.com/recaptcha/api.js?render={{data.recaptchaSiteKey}}"></script>
<script>

    // intercepts the form submit event
    const form = document.getElementById("signupForm");
    form.addEventListener("submit", onSubmit);

    // https://developers.google.com/recaptcha/docs/v3#programmatically_invoke_the_challenge
    // https://code.tutsplus.com/tutorials/example-of-how-to-add-google-recaptcha-v3-to-a-php-form--cms-33752
    function onSubmit(e) {
        e.preventDefault(); // prevent submitting the form
        grecaptcha.ready(function () {
            grecaptcha.execute('{{data.recaptchaSiteKey}}', { action: 'signup' }).then(function (token) {
                document.getElementById('g-recaptcha-response').value = token;
                form.submit();
            });
        });
    }

</script>
{{/section}}