<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Acasă</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/modifica">Cursuri</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/{{courseId}}/modifica">{{courseCode}}</a></li>
        <li class="breadcrumb-item"><a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/modifica">Cap.{{inc chapterIndex}}</a></li>
        <li class="breadcrumb-item active">L.{{inc lessonIndex}}</li>
        
        {{#if isEditMode}}
        <li title="Json" class="ms-auto me-2"><a href="/cursuri/{{courseId}}/lectii/{{lessonId}}/json"><i class="bi bi-braces me-1"></i></a></li>
        <li title="Vizualizează"><a href="/cursuri/{{courseId}}/lectii/{{lessonId}}"><i class="bi bi-eye me-1"></i></a></li>
        {{/if}}
    </ol>
</nav>

<h1>{{#if isEditMode}}Lecția {{inc lessonIndex}}: {{lesson.name}}{{else}}Lecție nouă{{/if}}</h1>

<form method="post" novalidate onsubmit="saveBtn.disabled = true; return true;">

    <div class="row mb-3">
        <div class="col-md-12">
            <label for="nameInput" class="fw-bold">Titlul lecției:</label>
            <input type="text" name="name" class="form-control" id="nameInput" placeholder=""
                value="{{lesson.name}}">
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <label for="descriptionInput" class="fw-bold">Descriere:</label>
            <textarea type="text" name="description" class="form-control" id="descriptionInput"
                placeholder="">{{lesson.description}}</textarea>
            <small><p class="text-muted mb-0">Doar tu (proprietarul) poți vedea această descriere</p></small>
        </div>
    </div>

    {{!-- theory --}}
    <div class="row mb-3">
        <div class="col-md-12 theory-div">
            <label class="fw-bold">Noțiuni teoretice:</label>

            {{!-- close the textarea tag on the same line to get rid of the unintended spaces: https://stackoverflow.com/a/34102261 --}}
            <textarea id="theory-editor-txt" rows="8" name="theory" type="text" 
                style="border-radius:0; border-bottom-width:0; border-color:#bb815d"
                class="form-control {{#if errors.lastName}}is-invalid {{/if}} {{#if isEditMode}}d-none{{/if}}" placeholder="">{{lesson.theory.text}}</textarea>
            <div class="invalid-feedback">{{errors.theory.msg}}</div>

            <div id="theory-preview-div" class="mt-0"
                style="border: 1px solid #bb815d; padding: 6px 12px; background-color: #fff9f8; min-height:58px">
                {{{lesson.theory.textPreview}}}
            </div>

            <span class="ms-end">
                <a id="toggle-theory-editor-btn" href="">{{#if isEditMode}}Editează{{else}}Ascunde{{/if}}</a>
            </span>
        </div>
    </div>

    {{#if isEditMode}}
        {{#each lesson.sectionsObj.sections}}
        <section id="section{{id}}">
            <div class="section-menu-div mt-5 mb-4 border-bottom border-secondary">
                <h2>{{name}}
                    <span class="text-muted fw-light">({{total}})</span>
                </h2>
            </div>

            <div class="section-content-div mb-3">
            {{#each levels}}
                <section>
                    <div class="level-menu-div">
                        <h3 class="fs-4">{{name}}

                            <a class="fs-6 add-exercise-btn me-2" title="Adaugă exercițiu" 
                                href="/cursuri/{{@root.courseId}}/capitole/{{@root.chapterId}}/lectii/{{@root.lessonId}}/sectiuni/{{../id}}/niveluri/{{id}}/exercitii/adauga">
                                <i class="bi bi-plus-square"></i>
                            </a>
                        </h3>
                    </div>

                    <div class="level-content-div mb-3">
                    {{#each exercises}}
                        <div class="exercise-div">
                            {{> exercise-statement @this}}
                            {{> exercise-menu @this sectionId = ../../id levelId = ../id allowView=true allowEdit=true allowDelete=true allowMove=true }}
                            {{> exercise-panels @this }}
                        </div>
                    {{/each}}
                    </div>
                </section>
            {{/each}}
            </div>
        </section>
        {{/each}}
    {{else}}
        <div class="alert alert-info mt-4" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            Salvează lecția pentru a putea adăuga exerciții!
        </div>
    {{/if}}

    <div class="row mb-3 mt-5">
        <div class="col-md-6">
            <label for="positionSelect" class="fw-bold">Poziția în listă:</label>
            <select name="position" class="form-select" id="positionSelect">
                {{#select selectedPosition}}
                {{#each availablePositions}}
                <option value="{{index}}">{{name}}</option>
                {{/each}}
                {{/select}}
            </select>
        </div>
    </div>

    <div class="form-check">
        <input type="checkbox" class="form-check-input" id="isHiddenCheck" name="isHidden" {{#if
            lesson.isHidden}}checked{{/if}}>
        <label class="form-check-label" for="isHiddenCheck">Ascunde</label>
        <small>
            <p class="text-muted mb-0">Doar tu (proprietarul) poți vedea resursele ascunse</p>
        </small>
    </div>

    <input type="hidden" name="courseId" value="{{courseId}}" />
    <input type="hidden" name="chapterId" value="{{chapterId}}" />

    <div class="mt-4">
        <div class="col-md-7s offset-md-3s">
            <button type="submit" name="saveBtn" class="btn btn-primary"><i class="bi bi-save"></i>
                Salveaza</button>

            {{#if isEditMode}}
            {{!-- <a href="/cursuri/{{courseId}}/capitole/{{chapterId}}/lectii/{{lessonId}}"
                class="btn btn-light"><i class="bi bi-eye"></i>
                Vizualizează</a> --}}
            <button type="submit"
                formaction="/cursuri/{{courseId}}/lectii/{{lessonId}}/sterge"
                name="deleteBtn" class="btn btn-link"
                onclick="return confirm('Ești sigur că vrei să ștergi această lecție?');"><i
                    class="bi bi-trash-fill"></i>
                Șterge</button>
            {{/if}}
        </div>
    </div>

</form>

{{!-- <hr class="mt-5 mb-5"> --}}
<div class="mt-5"></div>



{{#section 'script'}}
<script type="module" src="/js/eventBinders/course-lesson-create-or-edit.event-binder.js"></script>
{{/section}}